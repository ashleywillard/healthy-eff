%script{:src => "//cdnjs.cloudflare.com/ajax/libs/fullcalendar/1.6.4/fullcalendar.min.js"}
%link{:rel => "//cdnjs.cloudflare.com/ajax/libs/fullcalendar/1.6.4/fullcalendar.css"}

:javascript
  var amts = #{raw @amt_list}
  var index = 0
  
  $(document).ready(function() {
      setMoney();

      var random = []
      var workouts = #{raw @workouts.to_json}
      for(i=0;i<workouts.length;i++){
        workout = workouts[i]
        random[i]={title: workout[0]+': '+workout[1] + '\n'+ workout[6], start: workout[2], backgroundColor: workout[4], textColor: workout[3], borderColor: workout[5]}
      }
      $('#calendar').fullCalendar({
        header: {
          left: 'prev, today, next',
          center: 'title',
          right: ''
        },
        viewDisplay: function(view){
          var end = '#{@date.month-1}' +'/'+ '#{@date.year}'
          var begin = '#{@earliest_date.month-1}' +'/'+ '#{@earliest_date.year}'
          var cal_date_string = view.start.getMonth() + '/' + view.start.getFullYear()

          if(cal_date_string == begin) { jQuery('.fc-button-prev').addClass("fc-state-disabled"); }
          else { jQuery('.fc-button-prev').removeClass("fc-state-disabled"); }

          if(cal_date_string == end) { jQuery('.fc-button-next').addClass("fc-state-disabled"); }
          else { jQuery('.fc-button-next').removeClass("fc-state-disabled"); }

        },
        events: random
      })
      

  });
  
  function setMoney(){
    document.getElementById("money_earned").innerHTML = amts[index];
  };

  $('body').on('click', 'span.fc-button.fc-button-today.fc-state-default.fc-corner-left.fc-corner-right.fc-state-hover', function() {
    index = 0;
    setMoney();
  });

  $('body').on('click', 'span.fc-button.fc-button-next.fc-state-default.fc-corner-left.fc-corner-right.fc-state-hover', function() {
    if(index > 0){
      index -= 1;
      setMoney();
    }
  });

  $('body').on('click', 'span.fc-button.fc-button-prev.fc-state-default.fc-corner-left.fc-corner-right.fc-state-hover', function() {
    if(index < amts.length - 1){
      index += 1;
      setMoney();
    }
    
  });

%noscript
  %p.alert 
    %span.glyphicon.glyphicon-info-sign 
    Since JavaScript is disabled, this page only shows the current and previous month

#head
  %p.calendar
    %span.calendar_name= @name
    %span.money_earned{:id => 'money_earned'}

#money
  %p.money_caption="earned this month"
#calendar

%noscript
  %p
    %br
    %font{:size => "5"} Current Month

  %table#nojstable.table.table-striped
    %tr
      %td Day
      %td Activity
      %td Duration (minutes)
      %td Status
    - @no_js_curr_workouts.each do |workout|
      %tr
        %td= workout[2].strftime("%m/%d/%Y")
        %td= workout[0]
        %td= workout[1] 
        %td= workout[6][8..-1]
  
  %p
    %font{:size => "5"} Previous Month

  %table#nojstable.table.table-striped
    %tr
      %td Day
      %td Activity
      %td Duration (minutes)
      %td Status
    - @no_js_prev_workouts.each do |workout|
      %tr
        %td= workout[2].strftime("%m/%d/%Y")
        %td= workout[0]
        %td= workout[1] 
        %td= workout[6][8..-1]
